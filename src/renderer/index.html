<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FFmpeg 图形工具</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="backdrop" aria-hidden="true"></div>
    <main class="shell">
      <header class="hero reveal">
        <p class="tag">macOS 图形封装</p>
        <h1>FFmpeg 控制面板</h1>
        <p class="subtitle">预设模式用于快速操作，原生命令模式覆盖 FFmpeg 全部参数能力。</p>
      </header>

      <section class="panel reveal delay-1">
        <h2>任务设置</h2>

        <div class="grid-2">
          <label class="field">
            <span>FFmpeg 可执行文件</span>
            <input id="ffmpegPath" type="text" value="ffmpeg" placeholder="/opt/homebrew/bin/ffmpeg" />
          </label>

          <label class="field">
            <span>FFprobe 可执行文件</span>
            <input id="ffprobePath" type="text" value="ffprobe" placeholder="/opt/homebrew/bin/ffprobe" />
          </label>
        </div>

        <label class="field">
          <span>模式</span>
          <select id="mode">
            <option value="preset">预设模式（快速操作）</option>
            <option value="raw">原生命令模式（全部 FFmpeg 参数）</option>
          </select>
        </label>

        <div class="field-group">
          <label class="field field-grow">
            <span>输入文件（原生命令模式可选）</span>
            <input id="inputPath" type="text" placeholder="请选择源媒体文件" />
          </label>
          <button id="pickInput" class="btn btn-secondary" type="button">选择</button>
          <button id="probeInput" class="btn btn-secondary" type="button">探测</button>
        </div>

        <div class="field-group">
          <label class="field field-grow">
            <span>输出文件（原生命令模式可选）</span>
            <input id="outputPath" type="text" placeholder="请选择输出路径" />
          </label>
          <button id="pickOutput" class="btn btn-secondary" type="button">浏览</button>
        </div>

        <div id="presetFields" class="grid-2 mode-block">
          <label class="field">
            <span>预设</span>
            <select id="preset">
              <option value="h264">H.264 MP4（均衡）</option>
              <option value="h265">H.265 MP4（更小体积）</option>
              <option value="mp3">提取 MP3 音频</option>
              <option value="gif">转为 GIF</option>
            </select>
          </label>

          <label class="field" id="crfField">
            <span>CRF（视频质量）</span>
            <input id="crf" type="number" min="0" max="51" step="1" value="23" />
          </label>

          <label class="field">
            <span>起始时间（可选）</span>
            <input id="startTime" type="text" placeholder="00:00:05 或 5" />
          </label>

          <label class="field">
            <span>时长（可选）</span>
            <input id="duration" type="text" placeholder="15 或 00:00:15" />
          </label>

          <label class="field" id="gifFpsField">
            <span>GIF 帧率</span>
            <input id="fps" type="number" min="1" max="30" value="12" />
          </label>

          <label class="field" id="gifWidthField">
            <span>GIF 宽度</span>
            <input id="width" type="number" min="120" max="1920" value="480" />
          </label>
        </div>

        <div id="rawFields" class="mode-block hidden">
          <label class="field">
            <span>原生命令参数</span>
            <textarea
              id="rawArgs"
              rows="5"
              placeholder='示例： -y -i {input} -map 0:v -c:v libx264 -crf 23 -c:a aac {output}'
            ></textarea>
          </label>

          <p class="hint">使用占位符： <code>{input}</code>, <code>{output}</code>. 也可以不使用占位符，直接输入完整命令参数。</p>

          <div class="template-row">
            <button class="chip" type="button" data-template="-y -i {input} -c:v libx264 -preset medium -crf 23 -c:a aac -b:a 192k {output}">H.264</button>
            <button class="chip" type="button" data-template="-y -i {input} -c:v libx265 -preset medium -crf 28 -c:a aac -b:a 160k {output}">H.265</button>
            <button class="chip" type="button" data-template="-y -i {input} -vn -c:a libmp3lame -q:a 2 {output}">提取 MP3</button>
            <button class="chip" type="button" data-template="-y -i {input} -map 0:v:0 -c:v copy -an {output}">视频直拷贝</button>
          </div>

          <label class="field">
            <span>时长提示（可选，用于进度比例）</span>
            <input id="durationHint" type="text" placeholder="例如 120 或 00:02:00" />
          </label>
        </div>

        <details class="probe-box">
          <summary>媒体探测信息</summary>
          <pre id="probeInfo">暂无探测数据。</pre>
        </details>

        <div class="actions">
          <button id="runJob" class="btn btn-primary" type="button">开始执行</button>
          <button id="stopJob" class="btn btn-danger" type="button" disabled>停止</button>
        </div>
      </section>

      <section class="panel reveal delay-2">
        <h2>实时进度</h2>
        <div class="status-row">
          <span class="status-label">状态</span>
          <span id="status" class="status idle">空闲</span>
        </div>

        <div class="progress-wrap" aria-label="progress">
          <div id="progressBar" class="progress-bar"></div>
        </div>

        <div class="status-row">
          <span class="status-label">当前时间</span>
          <span id="currentTime">--:--</span>
        </div>
      </section>

      <section class="panel logs reveal delay-3">
        <h2>FFmpeg 日志</h2>
        <pre id="logOutput" aria-live="polite"></pre>
      </section>
    </main>

    <script type="module" src="./renderer.js"></script>
  </body>
</html>
